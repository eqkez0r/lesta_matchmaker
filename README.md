# MATCHMAKER 

## База данных

В папке deployment есть файл docker-compose.yaml с настроенным контейнером для работы.

Для запуска:
```
docker-compose up postgresql
```

## Хранилища

Реализованы два типа хранилища:
- memory - хранит в игроков в ОЗУ;
- [pgx](https://github.com/jackc/pgx) - драйвер для взаимодействия с PostgreSQL.

Используется логгер [zap](https://github.com/uber-go/zap).

Для HTTP-сервера используется фреймворк [gin-gonic/gin](https://github.com/gin-gonic/gin).

Имеется middleware для логирования.

Из обработчиков имеется только POST "/users", согласно ТЗ, который принимает json пользователя.

Параллельно в go-рутине работает сам matchmaker, который хранит в себе список игроков. 
При инициализации из хранилища берутся игроки, которые до этого находились в хранилище(т.к в memory storage не 
реализован механизм по сохранению в файл, это для pgx) и игроки отправляются в канал, который отвечает за matchmaking.

## Алгоритм

1) Приходит запрос на обработчик POST "/users/;
2) Полученный игрок отправляется в хранилище и в канал игроков;
3) Из канала происходит чтение в Matchmaker'е и игрок добавляется в мапу, у которой ключ - это округленное значение скилла
в меньшую сторону(так реализовано правило, касающее фильтрации по скиллу);
4) В случае, если в этом бакете достаточное кол-во игроков(groupSize), то формируется матч, выводится статистика, игроки удаляются
из хранилища и текущего бакета.

## Агент

Для тестов написан agent, находящийся в cmd/agent.

